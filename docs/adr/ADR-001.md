# ADR-001 – Monolito modular con superficies separadas (ABM vs Consumers)

**ID:** ADR-001  
**Estado:** Accepted  
**Fecha:** 2025-10-17  
**Autor:** Arquitectura del Proyecto Final

---

## Contexto

El sistema debe gestionar tanto la administración de usuarios, máquinas y empresas (ABM) como la recepción de datos de las máquinas (ingesta).  
Ambos flujos tienen requisitos distintos: seguridad, latencia y volumen de tráfico.

Se buscó una arquitectura que permita entregar rápido el MVP, pero que pueda evolucionar a servicios independientes en el futuro sin romper contratos.

---

## Decisión

Se implementará un **monolito modular en Go** bajo los principios de **Clean Architecture / Hexagonal**, con dos superficies HTTP claramente separadas:

- **/api/v1/** → Superficie **ABM**, autenticada con **JWT + RBAC** y con CORS habilitado.
- **/api/v1/consumers/** → Superficie de **ingesta**, autenticada con **API Key**, sin CORS, con políticas de **idempotencia** y **rate-limit**.

Cada superficie tendrá middlewares y contratos distintos.  
El flujo de dependencias se mantiene limpio:  
`transport → app → domain ← repo | security | telemetry | platform`.

---

## Alternativas consideradas

1. **Microservicios desde el inicio:** descartado por complejidad y sobrecosto operativo del MVP.
2. **Unificar todas las rutas en una sola API:** descartado por riesgos de seguridad y diferencias de latencia.

---

## Consecuencias

- Entrega rápida del MVP con alta mantenibilidad.
- Aislamiento lógico por capas y superficies.
- Facilita el escalamiento horizontal (Cloud Run / ECS) sin romper contratos.
- Camino limpio para extraer `/consumers` como microservicio futuro.
